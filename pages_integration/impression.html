<!DOCTYPE html>
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>CMS integration : Page for printing</title>
<link href="../interface/nuages/style.css" rel="stylesheet" type="text/css">
</head>
<body>
<h1>CMS integration</h1>
<ul>
<li>Introduction</li>
<li>Launching Daxe</li>
<li>Saving files</li>
<li>Directory listing</li>
</ul>
<hr>
<div style="page-break-after: always"></div>
<h1>Introduction</h1>
<div class="zone_texte">
    
<p>
      The Daxe web application needs to be integrated into a larger system to be able to save documents, as a web application does not have the rights to save a local file. Examples of integration include the <a target="_blank" class="lien" href="https://github.com/adopt/daxapp">Daxe desktop application</a> (written in Dart), <a target="_blank" class="lien" href="http://media4.obspm.fr/outils/webjaxe/en/">WebJaxe</a> (written in PHP) and <a target="_blank" class="lien" href="http://www.lon-capa.org/">LON-CAPA</a> (written in Perl).
    </p>
    
<p>
      In addition to a server-side processing of a request to save documents, servers should also provide directory listings with a specific format to let Daxe display a file chooser. This file chooser can be used to let users decide where to save an unsaved document, or to upload files used in the XML, such as image files.
    </p>
  
</div>
<div class="spacer"></div>
<hr>
<h1>Launching Daxe</h1>
<div class="zone_texte">
    
<p>
      The <span class="code">daxe</span> directory on the web server should simply be a copy of the <span class="code">web</span> directory after a build. These files are static and should be cached for better performance. The <span class="code">daxe.html</span> is used for debugging with <a target="_blank" class="lien" href="https://webdev.dartlang.org/tools/dartium">Dartium</a>, and can be removed in production. The file to launch is named <span class="code">daxe_js.html</span> after a build, and is usually renamed <span class="code">daxe.html</span> for simplicity.
    </p>
    
<p>
      Daxe is using the whole HTML document, using the URL to read parameters. It can be included in an iframe to fit inside a larger document.
    </p>
    
<p>
      The <span class="code">config</span> directory can be purged of configurations that are not used, although they will not cause additional requests if left there. The configuration files are the ones ending in <span class="code">_config.xml</span>, and they are often used with a schema file with a name ending in <span class="code">.xsd</span>.
    </p>
    
<p>
      The following parameters can be passed to the HTML file, as GET parameters. Paths can be relative to the HTML file.
    </p>
    
<div class="section_normale">
<h2>Parameters</h2>
      
<ul>
<li>

<span class="code">config</span>: the URL or path to the configuration file (required)</li>
<li>

<span class="code">file</span>: the URL or path to the file to be edited (optional, a new document is created if it is not specified)</li>
<li>

<span class="code">save</span>: the URL or path to the server script used to save a document (optional, the save menu does not appear if it is not specified)</li>
<li>

<span class="code">application</span>: should be <span class="code">true</span> for a desktop application (this adds the Open and Quit menus, and tells the server to quit at the end)</li>
</ul>
    
</div>
  
</div>
<div class="spacer"></div>
<hr>
<h1>Saving files</h1>
<div class="zone_texte">
    
<p>
      When a <span class="code">save</span> parameter is used to launch Daxe, a Save menu and toolbar button will appear.
    </p>
    
<p>
      Upon saving, the server receives a <em>multipart</em> POST request with the path of the document in the <span class="code">path</span> parameter and its content in the <span class="code">file</span> parameter. It replies with the text <span class="code">ok</span> if no error occured, or a string starting with <span class="code">error\n</span> if there was an error. An error message to display to the user can be included after <span class="code">error\n</span>.
    </p>
  
</div>
<div class="spacer"></div>
<hr>
<h1>Directory listing</h1>
<div class="zone_texte">
    
<p>
      To enable the file chooser in Daxe, the server simply has to return directory listings when a GET request to a directory is sent by the client. The returned content should be an XML file with the following syntax:
    </p>
    
<pre>
       &lt;directory name="current_dir"&gt;
          &lt;file name="example.txt" size="10" modified="2015-08-07T13:49:59"/&gt;
          &lt;directory name="sub_dir"/&gt;
        &lt;/directory&gt;
    </pre>
    
<p>
        The file size is in bytes. The modified timestamp is using ISO-8601.
    </p>
    
<p>
      To enable file uploads for the <span class="code">file</span> display type, the <span class="code">chooser</span> parameter should be set to <span class="code">true</span> in the configuration file. For instance, the whole element display for HTML's <span class="code">img</span> element would be:
    </p>
    
<pre>
      &lt;ELEMENT_DISPLAY element="img" type="file"&gt;
        &lt;PARAMETER name="srcAtt" value="src"/&gt;
        &lt;PARAMETER name="chooser" value="true"/&gt;
        &lt;PARAMETER name="widthAtt" value="width"/&gt;
        &lt;PARAMETER name="heightAtt" value="height"/&gt;
      &lt;/ELEMENT_DISPLAY&gt;
    </pre>
  
</div>
<div class="spacer"></div>
</body>
</html>
